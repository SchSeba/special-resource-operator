name: image-master

on: 
  pull_request:
    types: [ closed ]
  workflow_dispatch:

jobs: 
  merge_job:
    if: github.event.pull_request.merged == true
    name: build-master
    runs-on: [self-hosted, Linux, X64]
    steps:
    - uses: actions/checkout@v2
      with: 
        ref: "master"

    - name: add go path
      run: echo '~/go/bin' >> "$GITHUB_PATH"

    - name: TAG=master make local-image-build 
      run:  TAG=master make local-image-build
    
    - name: make local-image-push
      run: make local-image-push
  
  close_job:
    # this job will only run if the PR has been closed without being merged
    if: github.event.pull_request.merged == false
    runs-on: ubuntu-latest
    steps:
    - run: |
        echo PR #${{ github.event.number }} has been closed without being merged